<%- include('./partials/Header.ejs', {hidden: true}) %>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
    box-sizing: border-box;
  }

  .testimonial-layout {
    display: flex;
    gap: 3rem;
  }

  .testimonial-layout aside {
    min-width: 0;
  }
  .testimonial-section {
    display: flex;
    flex-direction: column;
    gap: 4rem;
  }
  .testimonial-item {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .insta {
    display: flex;
    align-items: center;
    justify-content: flex-end;
  }

  @media(max-width: 900px) {
    .testimonial-layout {
      flex-direction: column;
    }
  }
</style>
<style>
.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

.modal-box {
  background: #fff;
  padding: 1.5rem;
  border-radius: 8px;
  width: 350px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  animation: fadeIn 0.3s ease-in-out;
}

.modal-actions {
  margin-top: 1rem;
  display: flex;
  justify-content: space-between;
}

.btn-danger {
  background: red;
  color: #fff;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 5px;
}

.btn-secondary {
  background: #777;
  color: #fff;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 5px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.8); }
  to { opacity: 1; transform: scale(1); }
}
</style>


<main style="padding: var(--spacing-xl) 0; background-color: var(--color-bg-secondary); min-height: 100vh;">
    <div class="container">

        <!-- Flash Messages -->
        <% if(typeof error !=='undefined' && error.length> 0) { %>
            <div
                style="background: #fee2e2; color: #dc2626; padding: 1rem; border-radius: var(--border-radius-md); margin-bottom: 2rem; text-align: center;">
                <%= error[0] %>
            </div>
        <% } %>
        <% if (typeof success !=='undefined' && success.length> 0) { %>
            <div
                style="background: #dcfce7; color: #166534; padding: 1rem; border-radius: var(--border-radius-md); margin-bottom: 2rem; text-align: center;">
                <%= success[0] %>
            </div>
        <% } %>

        <div class="testimonial-layout">
            <!-- Sidebar -->
            <aside>
                <%- include('./partials/SellerSidebar.ejs') %>
            </aside>

            <!-- Main Content -->
            <div class="testimonial-section">
              <div class="add-testimonial" style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;">
                <h1><%= editingTestimonial ? "Edit Testimonial" : "Add Testimonial" %></h1>
                <form action="<%= editingTestimonial ? '/seller/testimonial/edit/' + editingTestimonial._id : '/seller/testimonial' %>" method="POST">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Username:</label>
                    <input type="text" name="username" value="<%= editingTestimonial ? editingTestimonial.username : '' %>"  style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;"required />
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Instagram Link:</label>
                    <input type="text" name="instagramLink"
                          value="<%= editingTestimonial ? editingTestimonial.instagramLink : '' %>"
                          style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;" />

                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Message:</label>
                    <textarea name="message" rows="4"
                              style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px; font-family: inherit;"
                              required><%= editingTestimonial ? editingTestimonial.message : '' %></textarea>

                    <button type="submit" class="btn btn-primary" style="padding: 0.8rem 2rem; align-self: flex-start;">
                        <%= editingTestimonial ? "Update Testimonial" : "Add Testimonial" %>
                    </button>
                </form>
              </div>


              <div class="your-testimonial" style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;">
                <h1>Your Testimonials</h1>
                <% if (testimonials.length > 0) { %>
                  <% testimonials.forEach(t => { %>
                    <div class="testimonial-item">
                      <div>
                        <p style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;">
                          <strong>Username:</strong> <%= t.username %>
                        </p>
                        <p style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;">
                          <strong>Message:</strong> <%= t.message %>
                        </p>
                        <% if(t.instagramLink) { %>
                          <a href="<%= t.instagramLink %>" target="_blank" class="insta">From Instagram</a>
                        <% } %>
                      </div>
                      <div>
                        <button class="btn btn-primary">
                          <a href="/seller/testimonial?edit=<%= t._id %>">Edit</a>
                        </button>
                        <form action="/seller/testimonial/delete/<%= t._id %>" method="POST" style="display:inline;">
                         <button type="button" class="btn btn-primary" onclick="openDeleteModal('<%= t._id %>')">Delete</button>

                          <!-- <button onclick="return confirm('Delete this testimonial?')" class="btn btn-primary">Delete</button> -->
                        </form>
                        <div id="deleteModal" class="modal-overlay">
                          <div class="modal-box">
                            <h3>Delete Testimonial?</h3>
                            <p>Are you sure you want to delete this testimonial?</p>

                            <div class="modal-actions">
                              <button type="button" class="btn btn-primary" onclick="closeDeleteModal()">Cancel</button>
                              <button type="button" class="btn btn-primary" onclick="confirmDelete()">Delete</button>
                            </div>
                          </div>
                        </div>
                        <form id="deleteForm" method="POST"></form>
                      </div>
                    </div>
                  <% }) %>
                <% } else { %>
                    <p>No testimonials yet.</p>
                <% } %>
              </div>
            </div>
        </div>
    </div>
</main>
  <script>
  let deleteId = null;

  function openDeleteModal(id) {
    deleteId = id;
    document.getElementById('deleteModal').style.display = 'flex';
  }

  function closeDeleteModal() {
    deleteId = null;
    document.getElementById('deleteModal').style.display = 'none';
  }

  function confirmDelete() {
    const form = document.getElementById('deleteForm');
    form.action = `/seller/testimonial/delete/${deleteId}`;
    form.submit();
  }
  </script>


