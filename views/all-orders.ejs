<%- include('./partials/Header.ejs', {hidden: true}) %>

    <main style="padding: var(--spacing-xl) 0; background-color: var(--color-bg-secondary); min-height: 80vh;">
        <div class="container">

            <div style="display: grid; grid-template-columns: 250px 1fr; gap: 2rem;">

                <!-- Sidebar -->
                <aside>
                    <%- include('./partials/SellerSidebar.ejs') %>
                </aside>

                <!-- Main Content -->
                <section
                    style="background: white; padding: 2.5rem; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-sm);">
                    <div
                        style="margin-bottom: 2rem; border-bottom: 1px solid var(--color-border); padding-bottom: 1rem;">
                        <h2 style="font-size: 1.5rem;">Total Orders</h2>
                    </div>

                    <% if (orders.length===0) { %>
                        <div style="text-align: center; padding: 4rem;">
                            <i class="ri-file-list-3-line"
                                style="font-size: 3rem; color: var(--color-text-secondary); margin-bottom: 1rem; display: block;"></i>
                            <p style="color: var(--color-text-secondary); font-size: 1.1rem; margin-bottom: 1rem;">No
                                orders yet.</p>
                        </div>
                        <% } else { %>
                            <div style="display: grid; gap: 1.5rem;">
                                <% orders.forEach(order=> { %>
                                    <div class="order-card"
                                        style="border: 1px solid var(--color-border); border-radius: var(--border-radius-md); padding: 1.5rem;">
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; border-bottom: 1px dashed var(--color-border); padding-bottom: 1rem;">
                                            <div>
                                                <h3 style="font-size: 1.1rem; font-weight: 600;">Order #<%=
                                                        String(order._id).slice(-8).toUpperCase() %>
                                                </h3>
                                                <p style="font-size: 0.9rem; color: var(--color-text-secondary);">Placed
                                                    on <%= new Date(order.createdAt).toLocaleDateString() %>
                                                </p>
                                            </div>
                                            <div style="text-align: right;">
                                                <span style="font-weight: 600; font-size: 1.1rem; color: var(--color-accent-primary);">PKR
                                                    <%= order.totalPrice %>
                                                </span>
                                                <div style="font-size: 0.7rem;">
                                                    <span>Shipping</span>
                                                    <span>250.00</span>
                                                </div>
                                                <div style="display: flex; flex-direction: column; font-size: 1.1rem; font-weight: 600;">
                                                    <span>Total</span>
                                                    <span style="color: var(--color-accent-primary);">
                                                        PKR <%= order.totalPrice + 250 %>
                                                    </span>
                                                </div>
                                                <div style="margin-top: 5px;">
                                                    <span
                                                        style="padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; background: #e0f2fe; color: #0369a1; text-transform: capitalize;">
                                                        <%= order.status %>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div
                                            style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 1rem;">
                                            <div>
                                                <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem;">
                                                    Items</h4>
                                                <ul style="list-style: none; padding: 0;">
                                                    <% order.items.forEach(item=> { %>
                                                        <li
                                                            style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 0.2rem;">
                                                            <span>
                                                                <% if(item.productId) { %>
                                                                    <a href="/products/<%=item.productId._id%>"
                                                                        style="color: var(--color-text-primary);">
                                                                        <%= item.productId.title %>
                                                                    </a>
                                                                    <% } else { %>
                                                                        Product Removed
                                                                        <% } %>
                                                                            x <%= item.quantity %>
                                                            </span>
                                                        </li>
                                                        <% }) %>
                                                </ul>
                                            </div>
                                            <div>
                                                <h4 style="font-size: 0.9rem; font-weight: 600; margin-bottom: 0.5rem;">
                                                    Shipping To</h4>
                                                <p style="font-size: 0.9rem; line-height: 1.4;">
                                                    <%= order.shippingAddress.street %><br>
                                                        <%= order.shippingAddress.city %>, <%=
                                                                order.shippingAddress.state %>
                                                                <%= order.shippingAddress.zip %><br>
                                                                    Phone: <%= order.phoneNumber %>
                                                </p>
                                            </div>
                                        </div>

                                        <div style="text-align: right;">
                                            <button class="btn btn-primary cancel-btn" data-id="<%= order._id %>"
                                                style="font-size: 0.9rem; padding: 0.5rem 1rem;">Cancel
                                                Order</button>
                                        </div>
                                    </div>
                                    <% }) %>
                            </div>
                            <% } %>
                </section>

            </div>
        </div>
    </main>

    <!-- Cancel Modal -->
    <div id="cancelModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div
            style="background: white; padding: 2rem; border-radius: var(--border-radius-md); width: 90%; max-width: 400px;">
            <h3 style="margin-bottom: 1rem;">Cancel Order</h3>
            <p style="margin-bottom: 1.5rem; color: var(--color-text-secondary);">Are you sure you want to cancel this
                order?</p>
            <div style="display: flex; justify-content: flex-end; gap: 1rem;">
                <button id="closeModal" class="btn btn-outline">No</button>
                <form id="cancelForm" method="POST">
                    <button type="submit" class="btn btn-primary"
                        style="background: #dc2626; border-color: #dc2626;">Yes, Cancel</button>
                </form>
            </div>
        </div>
    </div>

    <%- include('./partials/Footer.ejs') %>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const modal = document.getElementById('cancelModal');
                const form = document.getElementById('cancelForm');
                document.querySelectorAll('.cancel-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        form.action = `/orders/admin/cancel/${btn.dataset.id}`;
                        modal.style.display = 'flex';
                    });
                });
                document.getElementById('closeModal').addEventListener('click', () => modal.style.display = 'none');
            });
        </script>

        <style>
            @media(max-width: 768px) {
                .container>div {
                    grid-template-columns: 1fr !important;
                }

                .order-card>div:nth-child(2) {
                    grid-template-columns: 1fr !important;
                    gap: 1rem !important;
                }
            }
        </style>