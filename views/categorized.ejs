<%- include('./partials/Header.ejs') %>

  <main style="padding: var(--spacing-lg) 0; min-height: 60vh;">
    <div class="container">
      <!-- Page Title & Context -->
      <div
        style="margin-bottom: var(--spacing-md); border-bottom: 1px solid var(--color-border); padding-bottom: 1rem; display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 1rem;">
        <div>
          <% var searched=typeof searched !=='undefined' ? searched : false %>
            <% if (searched){ %>
              <h1>Results for "<%= request%>"</h1>
              <% } else if (cat){ %>
                <h1 style="text-transform: capitalize;">
                  <%= displayCategory%>
                </h1>
                <% } else if (gen) {%>
                  <h1 style="text-transform: capitalize;">
                    <%= gender%>'s Section
                  </h1>
                  <% } %>

                    <p style="color: var(--color-text-secondary); margin-top: 0.5rem;">
                      <%= selectedProducts.length %> items found
                    </p>
        </div>

        <!-- Filter (Only show if Category view) -->
        <% if (typeof cat !=='undefined' && cat) { %>
          <form action="/clothings/<%= category%>" method="get"
            style="display: flex; align-items: center; gap: 0.5rem;">
            <label for="gender-filter" style="font-size: 0.9rem; font-weight: 500;">Gender:</label>
            <select id="gender-filter" name="gender"
              style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; background: white;">
              <option value="all">All</option>
              <option value="boys">Boys</option>
              <option value="girls">Girls</option>
            </select>
            <button type="submit" class="btn btn-outline"
              style="padding: 0.5rem 1rem; font-size: 0.9rem;">Filter</button>
          </form>
          <% } %>
      </div>

      <!-- Product Grid -->
      <% if(selectedProducts.length> 0) { %>
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 2.5rem;">
          <% selectedProducts.forEach((fit)=> { %>
            <div class="product-card" style="display: flex; flex-direction: column;">
              <div
                style="position: relative; border-radius: var(--border-radius-md); overflow: hidden; margin-bottom: 1rem; box-shadow: var(--shadow-sm);">

                <% if (fit.discountInfo && fit.discountInfo.percent> 0) { %>
                  <span
                    style="position: absolute; top: 10px; left: 10px; background: var(--color-accent-primary); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; z-index: 10;">
                    <%= fit.discountInfo.percent %>% OFF
                  </span>
                  <% } %>

                    <a href="/products/<%= fit._id %>" style="display: block; padding-top: 130%; position: relative;">
                      <img src="<%= fit.mainImage %>" alt="<%= fit.title %>"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
                    </a>
              </div>

              <div style="display: flex; flex-direction: column; padding: 0.8rem;">
                <div style="flex-grow: 1; ">
                  <h3 style="font-size: 1.1rem; font-family: var(--font-body); margin-bottom: 0.5rem;">
                    <a href="/products/<%= fit._id %>">
                      <%= fit.title %>
                    </a>
                  </h3>

                  <!-- Colors -->
                  <% if (fit.color && Array.isArray(fit.color)) { %>
                    <div style="display: flex; gap: 4px; margin-bottom: 0.5rem;">
                      <% fit.color.forEach(c=> { %>
                        <span
                          style="width: 12px; height: 12px; rounded-full; background-color: <%= c %>; display: inline-block; border-radius: 50%; border: 1px solid #ddd;"></span>
                        <% }) %>
                    </div>
                    <% } %>

                      <!-- Price -->
                      <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 1rem;">
                        <% if (fit.discountInfo && fit.discountInfo.percent> 0) { %>
                          <span style="text-decoration: line-through; color: #999; font-size: 0.9rem;">PKR <%= fit.price
                              %></span>
                          <span style="color: var(--color-accent-primary); font-weight: 600;">PKR <%=
                              fit.discountInfo.finalPrice %></span>
                          <% } else { %>
                            <span style="font-weight: 600;">PKR <%= fit.price %></span>
                            <% } %>
                      </div>
                </div>

                <button data-fitId="<%= fit._id%>" class="btn btn-primary add-btn" style="width: 100%;">
                  <i class="ri-shopping-cart-2-line" style="margin-right: 5px;"></i> Add to Cart
                </button>
              </div>
            </div>
            <% }) %>
        </div>
        <% } else { %>
          <div style="padding: 4rem 0; text-align: center;">
            <h3 style="color: var(--color-text-secondary);">No products found matching your criteria.</h3>
            <a href="/" class="btn btn-outline" style="margin-top: 1rem;">Back to Home</a>
          </div>
          <% } %>
    </div>
  </main>

  <%- include('./partials/Footer.ejs') %>
  <script src="/javascripts/index.js"></script>
<script>
  addToCart();
</script>
